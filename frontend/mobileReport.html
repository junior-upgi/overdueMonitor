<!doctype html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="utf-8" http-equiv="pragma" content="no-cache" />
    <title>逾期款日報</title>
</head>

<body>
    <h1>逾期款日報</h1>
    <h4 id="currentDate"></h4>
    <div>
        <div>
            <h2>【逾期款項產生】</h2>
            <ul id="newOverdueList">
            </ul>
        </div>
        <div>
            <h2>【當週逾期款項提醒】</h2>
            <ul id="weeklyOverdueSummary">
            </ul>
        </div>
    </div>
</body>

</html>

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js" charset="utf-8"></script>
<script>
    $(document).ready(function() {
        var currentDate = new Date();
        $("#currentDate").text(currentDate.getFullYear() + '/' + (currentDate.getMonth() + 1) + '/' + currentDate.getDate());
        $.getJSON("dataSource/overdueAlert.php", function(result) {
            $.each(result, function(recordIndex, record) {
                $("#newOverdueList").append("<li class=\"overdueItem newOverdue\" data-client=\"" + record.CUS_NO + "\">" + record.content + "</li>");
            });
            $(".newOverdue").css("color", "red");
            $.getJSON("dataSource/weeklyAlert.php", function(result) {
                $.each(result, function(recordIndex, record) {
                    if (record.G_PERIOD_REMAIN == 0) {
                        $("#weeklyOverdueSummary").append("<li class=\"overdueItem weekOldOverdue\" data-client=\"" + record.CUS_NO + "\">" + record.content + "</li>");
                    } else {
                        $("#weeklyOverdueSummary").append("<li class=\"overdueItem\" data-client=\"" + record.CUS_NO + "\">" + record.content + "</li>");
                    }
                });
                $(".weekOldOverdue").css("color", "red");
                $(".overdueItem").click(function() {
                    if ($(this).hasClass("selected") == false) {
                        $(".selected").removeClass("selected");
                        $(this).addClass("selected");
                        console.log($(this).data("client"));
                        $.getJSON("dataSource/transactionDetail.php?CUS_NO=" + $(this).data("client"), function(result) {
                            $("#dynamicTable").remove();
                            $(".selected").append("<table id=\"dynamicTable\" border=\"1\"></table>");
                            $("#dynamicTable").append("<tr class=\"heading\"><th>銷貨編號</th><th>出貨日期</th><th>出貨金額</th><th>剩餘時間</th></tr>");
                            $.each(result, function(recordIndex, record) {
                                if (record.G_PERIOD_REMAIN == 0) {
                                    $("#dynamicTable").append("<tr class=\"overdue\"><td>" + record.PS_NO + "</td><td>" + record.PS_DD + "</td><td>" + record.AMTN_OUT + "</td><td>" + record.G_PERIOD_REMAIN + "</td></tr>");
                                } else {
                                    $("#dynamicTable").append("<tr class=\"pending\"><td>" + record.PS_NO + "</td><td>" + record.PS_DD + "</td><td>" + record.AMTN_OUT + "</td><td>" + record.G_PERIOD_REMAIN + "</td></tr>");
                                }
                            });
                            $("tr.overdue").css("color", "red");
                            $("tr.pending,tr.heading").css("color", "black");
                        });
                    } else {
                        $(this).removeClass("selected");
                        $("#dynamicTable").remove();
                    }
                });
            });
        });
    });
</script>